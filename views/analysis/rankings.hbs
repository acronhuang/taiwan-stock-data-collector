<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨æ’è¡Œæ¦œ - æŠ€è¡“åˆ†æç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .ranking-card:hover {
            transform: translateY(-1px);
            transition: transform 0.2s ease-in-out;
        }
        .rank-medal {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        .rank-1 { background: linear-gradient(45deg, #ffd700, #ffed4e); color: #8b5a00; }
        .rank-2 { background: linear-gradient(45deg, #c0c0c0, #e5e5e5); color: #666; }
        .rank-3 { background: linear-gradient(45deg, #cd7f32, #deb887); color: #5d4e37; }
        .rank-other { background: linear-gradient(45deg, #6b7280, #9ca3af); }
        .tab-active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- å°èˆªæ¬„ -->
    <nav class="bg-blue-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">ğŸ† è‚¡ç¥¨æ’è¡Œæ¦œ</h1>
                <p class="text-blue-200">å„é …æŠ€è¡“æŒ‡æ¨™èˆ‡å¸‚å ´è¡¨ç¾æ’å</p>
            </div>
            <div class="flex items-center space-x-4">
                <a href="/analysis" class="hover:bg-blue-700 px-3 py-2 rounded">ç¸½è¦½</a>
                <a href="/analysis/dashboard" class="hover:bg-blue-700 px-3 py-2 rounded">å„€è¡¨æ¿</a>
                <a href="/analysis/signals" class="hover:bg-blue-700 px-3 py-2 rounded">ä¿¡è™Ÿ</a>
                <div class="flex items-center space-x-2">
                    <label class="text-sm">å¸‚å ´:</label>
                    <select id="marketFilter" onchange="filterByMarket()" class="bg-blue-700 border border-blue-500 rounded px-2 py-1 text-sm">
                        <option value="all">å…¨éƒ¨</option>
                        <option value="twse">ä¸Šå¸‚</option>
                        <option value="tpex">ä¸Šæ«ƒ</option>
                    </select>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-6 p-4">
        <!-- æ’è¡Œæ¦œé¡å‹é¸æ“‡ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex flex-wrap gap-2">
                <button onclick="switchTab('technical')" class="tab-btn px-4 py-2 rounded-md border transition-colors tab-active">
                    æŠ€è¡“è©•åˆ†æ’è¡Œ
                </button>
                <button onclick="switchTab('performance')" class="tab-btn px-4 py-2 rounded-md border transition-colors">
                    ç¸¾æ•ˆè¡¨ç¾æ’è¡Œ
                </button>
                <button onclick="switchTab('volume')" class="tab-btn px-4 py-2 rounded-md border transition-colors">
                    æˆäº¤é‡æ’è¡Œ
                </button>
                <button onclick="switchTab('volatility')" class="tab-btn px-4 py-2 rounded-md border transition-colors">
                    æ³¢å‹•ç‡æ’è¡Œ
                </button>
                <button onclick="switchTab('momentum')" class="tab-btn px-4 py-2 rounded-md border transition-colors">
                    å‹•èƒ½æŒ‡æ¨™æ’è¡Œ
                </button>
            </div>
        </div>

        <!-- æŠ€è¡“è©•åˆ†æ’è¡Œ -->
        <div id="technicalTab" class="ranking-section">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- æœ€ä½³æŠ€è¡“è©•åˆ† -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ¥‡ æŠ€è¡“è©•åˆ†å‰20å</h3>
                    <div class="space-y-3">
                        {{#each technicalRanking}}
                        <div class="ranking-card flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="rank-medal rank-{{getRankClass @index}}">
                                    {{add @index 1}}
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{this.symbol}}</p>
                                    <p class="text-sm text-gray-600">{{this.name}}</p>
                                    <p class="text-xs text-gray-500">{{this.market}} â€¢ {{this.sector}}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-blue-600">{{this.technicalScore}}</p>
                                <p class="text-sm {{getRecommendationClass this.recommendation}}">
                                    {{getRecommendationText this.recommendation}}
                                </p>
                                <p class="text-sm text-gray-600">${{this.closePrice}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>

                <!-- æŠ€è¡“è©•åˆ†åˆ†å¸ƒåœ– -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š æŠ€è¡“è©•åˆ†åˆ†å¸ƒ</h3>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="technicalScoreChart"></canvas>
                    </div>
                    <div class="mt-4 grid grid-cols-5 gap-2 text-center">
                        <div>
                            <p class="text-xs text-gray-600">0-20</p>
                            <p class="font-bold text-red-600">{{scoreDistribution.range0_20}}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">21-40</p>
                            <p class="font-bold text-orange-600">{{scoreDistribution.range21_40}}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">41-60</p>
                            <p class="font-bold text-yellow-600">{{scoreDistribution.range41_60}}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">61-80</p>
                            <p class="font-bold text-blue-600">{{scoreDistribution.range61_80}}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">81-100</p>
                            <p class="font-bold text-green-600">{{scoreDistribution.range81_100}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¸¾æ•ˆè¡¨ç¾æ’è¡Œ -->
        <div id="performanceTab" class="ranking-section" style="display: none;">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- æ—¥æ¼²å¹…æ’è¡Œ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“ˆ æ—¥æ¼²å¹…å‰10å</h3>
                    <div class="space-y-3">
                        {{#each dayGainers}}
                        <div class="ranking-card flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="rank-medal rank-{{getRankClass @index}}">{{add @index 1}}</div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{this.symbol}}</p>
                                    <p class="text-sm text-gray-600">{{this.name}}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-green-600">+{{this.changePercent}}%</p>
                                <p class="text-sm text-gray-600">${{this.closePrice}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>

                <!-- æ—¥è·Œå¹…æ’è¡Œ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“‰ æ—¥è·Œå¹…å‰10å</h3>
                    <div class="space-y-3">
                        {{#each dayLosers}}
                        <div class="ranking-card flex items-center justify-between p-3 bg-red-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="rank-medal rank-{{getRankClass @index}}">{{add @index 1}}</div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{this.symbol}}</p>
                                    <p class="text-sm text-gray-600">{{this.name}}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-red-600">{{this.changePercent}}%</p>
                                <p class="text-sm text-gray-600">${{this.closePrice}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>

                <!-- ç¸¾æ•ˆåœ–è¡¨ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š å¸‚å ´ç¸¾æ•ˆåˆ†å¸ƒ</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="performanceChart"></canvas>
                    </div>
                    <div class="mt-4 text-center">
                        <div class="grid grid-cols-3 gap-2">
                            <div>
                                <p class="text-sm text-green-600">ä¸Šæ¼²</p>
                                <p class="font-bold text-green-600">{{performanceStats.gainers}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">å¹³ç›¤</p>
                                <p class="font-bold text-gray-600">{{performanceStats.unchanged}}</p>
                            </div>
                            <div>
                                <p class="text-sm text-red-600">ä¸‹è·Œ</p>
                                <p class="font-bold text-red-600">{{performanceStats.losers}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æˆäº¤é‡æ’è¡Œ -->
        <div id="volumeTab" class="ranking-section" style="display: none;">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- æˆäº¤é‡æ’è¡Œ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ’° æˆäº¤é‡å‰20å</h3>
                    <div class="space-y-3">
                        {{#each volumeRanking}}
                        <div class="ranking-card flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="rank-medal rank-{{getRankClass @index}}">{{add @index 1}}</div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{this.symbol}}</p>
                                    <p class="text-sm text-gray-600">{{this.name}}</p>
                                    <p class="text-xs text-gray-500">{{this.market}}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-purple-600">{{formatVolume this.volume}}</p>
                                <p class="text-sm text-gray-600">{{formatAmount this.tradeValue}} åƒå…ƒ</p>
                                <p class="text-sm {{#if (gt this.changePercent 0)}}text-green-600{{else}}text-red-600{{/if}}">
                                    {{#if (gt this.changePercent 0)}}+{{/if}}{{this.changePercent}}%
                                </p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>

                <!-- æˆäº¤é‡åˆ†æåœ– -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š æˆäº¤é‡åˆ†æ</h3>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="volumeAnalysisChart"></canvas>
                    </div>
                    <div class="mt-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center">
                                <p class="text-sm text-gray-600">ç¸½æˆäº¤é‡</p>
                                <p class="font-bold text-blue-600">{{formatVolume volumeStats.total}}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-600">å¹³å‡æˆäº¤é‡</p>
                                <p class="font-bold text-green-600">{{formatVolume volumeStats.average}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ³¢å‹•ç‡æ’è¡Œ -->
        <div id="volatilityTab" class="ranking-section" style="display: none;">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- é«˜æ³¢å‹•ç‡æ’è¡Œ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š é«˜æ³¢å‹•ç‡å‰20å</h3>
                    <div class="space-y-3">
                        {{#each highVolatility}}
                        <div class="ranking-card flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="rank-medal rank-{{getRankClass @index}}">{{add @index 1}}</div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{this.symbol}}</p>
                                    <p class="text-sm text-gray-600">{{this.name}}</p>
                                    <p class="text-xs text-gray-500">{{this.sector}}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-orange-600">{{this.volatility}}%</p>
                                <p class="text-sm text-gray-600">æœ€é«˜: ${{this.highPrice}}</p>
                                <p class="text-sm text-gray-600">æœ€ä½: ${{this.lowPrice}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>

                <!-- æ³¢å‹•ç‡åˆ†å¸ƒ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“ˆ æ³¢å‹•ç‡åˆ†å¸ƒåœ–</h3>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="volatilityChart"></canvas>
                    </div>
                    <div class="mt-4 grid grid-cols-4 gap-2 text-center">
                        <div>
                            <p class="text-xs text-gray-600">ä½æ³¢å‹•</p>
                            <p class="text-xs text-gray-600">&lt;2%</p>
                            <p class="font-bold text-blue-600">{{volatilityStats.low}}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">ä¸­æ³¢å‹•</p>
                            <p class="text-xs text-gray-600">2-5%</p>
                            <p class="font-bold text-green-600">{{volatilityStats.medium}}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">é«˜æ³¢å‹•</p>
                            <p class="text-xs text-gray-600">5-10%</p>
                            <p class="font-bold text-orange-600">{{volatilityStats.high}}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">æ¥µé«˜æ³¢å‹•</p>
                            <p class="text-xs text-gray-600">&gt;10%</p>
                            <p class="font-bold text-red-600">{{volatilityStats.extreme}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å‹•èƒ½æŒ‡æ¨™æ’è¡Œ -->
        <div id="momentumTab" class="ranking-section" style="display: none;">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- RSIæ’è¡Œ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š RSIå¼·å‹¢è‚¡</h3>
                    <div class="space-y-3">
                        {{#each rsiRanking}}
                        <div class="ranking-card flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="rank-medal rank-{{getRankClass @index}}">{{add @index 1}}</div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{this.symbol}}</p>
                                    <p class="text-sm text-gray-600">{{this.name}}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-purple-600">{{this.rsi}}</p>
                                <p class="text-xs {{getRSIClass this.rsi}}">{{getRSIText this.rsi}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>

                <!-- MACDæ’è¡Œ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“ˆ MACDé»ƒé‡‘äº¤å‰</h3>
                    <div class="space-y-3">
                        {{#each macdRanking}}
                        <div class="ranking-card flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="rank-medal rank-{{getRankClass @index}}">{{add @index 1}}</div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{this.symbol}}</p>
                                    <p class="text-sm text-gray-600">{{this.name}}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-blue-600">{{this.macd}}</p>
                                <p class="text-xs text-gray-600">ä¿¡è™Ÿç·š: {{this.macdSignal}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>

                <!-- KDæ’è¡Œ -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">âš¡ KDé»ƒé‡‘äº¤å‰</h3>
                    <div class="space-y-3">
                        {{#each kdRanking}}
                        <div class="ranking-card flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="rank-medal rank-{{getRankClass @index}}">{{add @index 1}}</div>
                                <div>
                                    <p class="font-semibold text-gray-900">{{this.symbol}}</p>
                                    <p class="text-sm text-gray-600">{{this.name}}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-yellow-600">K: {{this.kValue}}</p>
                                <p class="text-xs text-gray-600">D: {{this.dValue}}</p>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆ‡æ›æ¨™ç±¤é 
        function switchTab(tabName) {
            // éš±è—æ‰€æœ‰æ’è¡Œæ¦œå€åŸŸ
            document.querySelectorAll('.ranking-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤æŒ‰éˆ•çš„æ´»å‹•ç‹€æ…‹
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ’è¡Œæ¦œå€åŸŸ
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // æ¨™è¨˜é»æ“Šçš„æŒ‰éˆ•ç‚ºæ´»å‹•ç‹€æ…‹
            event.target.classList.add('tab-active');
        }

        // å¸‚å ´ç¯©é¸
        function filterByMarket() {
            const market = document.getElementById('marketFilter').value;
            // æ ¹æ“šå¸‚å ´ç¯©é¸æ•¸æ“šçš„é‚è¼¯
            if (market !== 'all') {
                window.location.href = `?market=${market}`;
            } else {
                window.location.href = window.location.pathname;
            }
        }

        // è¼”åŠ©å‡½æ•¸
        function getRankClass(index) {
            if (index === 0) return '1';
            if (index === 1) return '2';
            if (index === 2) return '3';
            return 'other';
        }

        function getRecommendationClass(recommendation) {
            switch(recommendation) {
                case 'strong_buy': return 'text-green-600';
                case 'buy': return 'text-blue-600';
                case 'hold': return 'text-yellow-600';
                case 'sell': return 'text-orange-600';
                case 'strong_sell': return 'text-red-600';
                default: return 'text-gray-600';
            }
        }

        function getRecommendationText(recommendation) {
            switch(recommendation) {
                case 'strong_buy': return 'å¼·çƒˆè²·é€²';
                case 'buy': return 'è²·é€²';
                case 'hold': return 'æŒæœ‰';
                case 'sell': return 'è³£å‡º';
                case 'strong_sell': return 'å¼·çƒˆè³£å‡º';
                default: return '-';
            }
        }

        function getRSIClass(rsi) {
            if (rsi >= 70) return 'text-red-600';
            if (rsi <= 30) return 'text-green-600';
            return 'text-blue-600';
        }

        function getRSIText(rsi) {
            if (rsi >= 70) return 'è¶…è²·';
            if (rsi <= 30) return 'è¶…è³£';
            return 'æ­£å¸¸';
        }

        function formatVolume(volume) {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(2) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(2) + 'K';
            }
            return volume;
        }

        function formatAmount(amount) {
            return (amount / 1000).toFixed(0);
        }

        function add(a, b) {
            return a + b;
        }

        // åˆå§‹åŒ–åœ–è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
        });

        function initializeCharts() {
            // æŠ€è¡“è©•åˆ†åˆ†å¸ƒåœ–
            const techScoreCtx = document.getElementById('technicalScoreChart').getContext('2d');
            new Chart(techScoreCtx, {
                type: 'bar',
                data: {
                    labels: ['0-20', '21-40', '41-60', '61-80', '81-100'],
                    datasets: [{
                        label: 'è‚¡ç¥¨æ•¸é‡',
                        data: [
                            {{scoreDistribution.range0_20}},
                            {{scoreDistribution.range21_40}},
                            {{scoreDistribution.range41_60}},
                            {{scoreDistribution.range61_80}},
                            {{scoreDistribution.range81_100}}
                        ],
                        backgroundColor: [
                            '#ef4444',
                            '#f97316',
                            '#eab308',
                            '#3b82f6',
                            '#10b981'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // å…¶ä»–åœ–è¡¨åˆå§‹åŒ–...
        }
    </script>
</body>
</html>