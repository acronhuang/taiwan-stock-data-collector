<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{stockInfo.symbol}} {{stockInfo.name}} - æŠ€è¡“åˆ†æ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        .indicator-chart {
            position: relative;
            height: 200px;
            margin-bottom: 15px;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease-in-out;
        }
        .signal-strong { background: linear-gradient(45deg, #059669, #10b981); }
        .signal-weak { background: linear-gradient(45deg, #7c3aed, #8b5cf6); }
        .signal-neutral { background: linear-gradient(45deg, #6b7280, #9ca3af); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- å°èˆªæ¬„ -->
    <nav class="bg-blue-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <a href="/analysis" class="hover:text-blue-200">â† è¿”å›ç¸½è¦½</a>
                <h1 class="text-2xl font-bold">{{stockInfo.symbol}} {{stockInfo.name}}</h1>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-sm">æ›´æ–°æ™‚é–“: {{lastUpdate}}</span>
                <button onclick="refreshData()" class="bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded text-sm">
                    ğŸ”„ åˆ·æ–°
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-6 p-4">
        <!-- è‚¡ç¥¨åŸºæœ¬è³‡è¨Š -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                <div class="text-center">
                    <p class="text-sm text-gray-600">æ”¶ç›¤åƒ¹</p>
                    <p class="text-3xl font-bold text-gray-900">${{stockInfo.closePrice}}</p>
                    <p class="text-sm {{#if (gt stockInfo.changePercent 0)}}text-green-600{{else}}text-red-600{{/if}}">
                        {{#if (gt stockInfo.changePercent 0)}}+{{/if}}{{stockInfo.changePercent}}%
                    </p>
                </div>
                <div class="text-center">
                    <p class="text-sm text-gray-600">æŠ€è¡“è©•åˆ†</p>
                    <p class="text-2xl font-bold text-blue-600">{{technicalAnalysis.technicalScore}}</p>
                    <div class="mt-1">
                        <span class="px-2 py-1 text-xs rounded-full {{getRecommendationClass technicalAnalysis.recommendation}}">
                            {{getRecommendationText technicalAnalysis.recommendation}}
                        </span>
                    </div>
                </div>
                <div class="text-center">
                    <p class="text-sm text-gray-600">æˆäº¤é‡</p>
                    <p class="text-xl font-semibold text-gray-900">{{formatVolume stockInfo.volume}}</p>
                    <p class="text-sm text-gray-600">{{stockInfo.tradeValue}}</p>
                </div>
                <div class="text-center">
                    <p class="text-sm text-gray-600">æ¼²è·Œå¹…</p>
                    <p class="text-xl font-semibold {{#if (gt stockInfo.changePercent 0)}}text-green-600{{else}}text-red-600{{/if}}">
                        {{#if (gt stockInfo.changePercent 0)}}+{{/if}}{{stockInfo.change}}
                    </p>
                    <p class="text-sm text-gray-600">å¹…åº¦ {{stockInfo.changePercent}}%</p>
                </div>
                <div class="text-center">
                    <p class="text-sm text-gray-600">å¸‚å ´é¡å‹</p>
                    <p class="text-lg font-semibold text-gray-900">{{stockInfo.market}}</p>
                    <p class="text-sm text-gray-600">{{stockInfo.industry}}</p>
                </div>
            </div>
        </div>

        <!-- æŠ€è¡“æŒ‡æ¨™ä¿¡è™Ÿ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š æŠ€è¡“æŒ‡æ¨™ä¿¡è™Ÿ</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- è²·é€²ä¿¡è™Ÿ -->
                <div class="bg-green-50 rounded-lg p-4">
                    <h4 class="font-semibold text-green-800 mb-3">è²·é€²ä¿¡è™Ÿ</h4>
                    <div class="space-y-2">
                        {{#if technicalAnalysis.signals.macdBuy}}
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                            <span class="text-sm">MACD é»ƒé‡‘äº¤å‰</span>
                        </div>
                        {{/if}}
                        {{#if technicalAnalysis.signals.kdGoldenCross}}
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                            <span class="text-sm">KD é»ƒé‡‘äº¤å‰</span>
                        </div>
                        {{/if}}
                        {{#if technicalAnalysis.signals.rsiOversold}}
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                            <span class="text-sm">RSI è¶…è³£åå½ˆ</span>
                        </div>
                        {{/if}}
                        {{#if technicalAnalysis.signals.bollingerBuySignal}}
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                            <span class="text-sm">å¸ƒæ—å¸¶çªç ´</span>
                        </div>
                        {{/if}}
                        {{#unless (or technicalAnalysis.signals.macdBuy technicalAnalysis.signals.kdGoldenCross technicalAnalysis.signals.rsiOversold technicalAnalysis.signals.bollingerBuySignal)}}
                        <p class="text-sm text-gray-500">ç›®å‰ç„¡è²·é€²ä¿¡è™Ÿ</p>
                        {{/unless}}
                    </div>
                </div>

                <!-- è³£å‡ºä¿¡è™Ÿ -->
                <div class="bg-red-50 rounded-lg p-4">
                    <h4 class="font-semibold text-red-800 mb-3">è³£å‡ºä¿¡è™Ÿ</h4>
                    <div class="space-y-2">
                        {{#if technicalAnalysis.signals.macdSell}}
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                            <span class="text-sm">MACD æ­»äº¡äº¤å‰</span>
                        </div>
                        {{/if}}
                        {{#if technicalAnalysis.signals.kdDeathCross}}
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                            <span class="text-sm">KD æ­»äº¡äº¤å‰</span>
                        </div>
                        {{/if}}
                        {{#if technicalAnalysis.signals.rsiOverbought}}
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                            <span class="text-sm">RSI è¶…è²·å›èª¿</span>
                        </div>
                        {{/if}}
                        {{#if technicalAnalysis.signals.bollingerSellSignal}}
                        <div class="flex items-center space-x-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                            <span class="text-sm">å¸ƒæ—å¸¶åè½‰</span>
                        </div>
                        {{/if}}
                        {{#unless (or technicalAnalysis.signals.macdSell technicalAnalysis.signals.kdDeathCross technicalAnalysis.signals.rsiOverbought technicalAnalysis.signals.bollingerSellSignal)}}
                        <p class="text-sm text-gray-500">ç›®å‰ç„¡è³£å‡ºä¿¡è™Ÿ</p>
                        {{/unless}}
                    </div>
                </div>

                <!-- ä¸­æ€§ä¿¡è™Ÿ -->
                <div class="bg-yellow-50 rounded-lg p-4">
                    <h4 class="font-semibold text-yellow-800 mb-3">è¶¨å‹¢ç‹€æ…‹</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">çŸ­æœŸè¶¨å‹¢</span>
                            <span class="text-sm font-semibold {{getTrendClass technicalAnalysis.shortTermTrend}}">
                                {{getTrendText technicalAnalysis.shortTermTrend}}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">ä¸­æœŸè¶¨å‹¢</span>
                            <span class="text-sm font-semibold {{getTrendClass technicalAnalysis.mediumTermTrend}}">
                                {{getTrendText technicalAnalysis.mediumTermTrend}}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">é•·æœŸè¶¨å‹¢</span>
                            <span class="text-sm font-semibold {{getTrendClass technicalAnalysis.longTermTrend}}">
                                {{getTrendText technicalAnalysis.longTermTrend}}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">æ”¯æ’ä½</span>
                            <span class="text-sm font-semibold">${{technicalAnalysis.supportLevel}}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">é˜»åŠ›ä½</span>
                            <span class="text-sm font-semibold">${{technicalAnalysis.resistanceLevel}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åœ–è¡¨å€åŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Kç·šåœ– -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“ˆ Kç·šåœ–èˆ‡ç§»å‹•å¹³å‡ç·š</h3>
                <div class="chart-container">
                    <canvas id="candlestickChart"></canvas>
                </div>
            </div>

            <!-- æŠ€è¡“æŒ‡æ¨™åœ– -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š æŠ€è¡“æŒ‡æ¨™åœ–</h3>
                <div class="chart-container">
                    <canvas id="technicalChart"></canvas>
                </div>
            </div>
        </div>

        <!-- è©³ç´°æŠ€è¡“æŒ‡æ¨™ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- RSI -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h4 class="font-semibold text-gray-800 mb-3">RSI ç›¸å°å¼·å¼±æŒ‡æ¨™</h4>
                <div class="text-center">
                    <p class="text-3xl font-bold {{getRSIClass technicalAnalysis.rsi}}">
                        {{technicalAnalysis.rsi}}
                    </p>
                    <p class="text-sm text-gray-600 mt-1">{{getRSIText technicalAnalysis.rsi}}</p>
                </div>
                <div class="indicator-chart">
                    <canvas id="rsiChart"></canvas>
                </div>
            </div>

            <!-- MACD -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h4 class="font-semibold text-gray-800 mb-3">MACD æŒ‡æ¨™</h4>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-sm">MACD</span>
                        <span class="font-semibold">{{technicalAnalysis.macd}}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">ä¿¡è™Ÿç·š</span>
                        <span class="font-semibold">{{technicalAnalysis.macdSignal}}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">æŸ±ç‹€åœ–</span>
                        <span class="font-semibold {{#if (gt technicalAnalysis.macdHistogram 0)}}text-green-600{{else}}text-red-600{{/if}}">
                            {{technicalAnalysis.macdHistogram}}
                        </span>
                    </div>
                </div>
                <div class="indicator-chart">
                    <canvas id="macdChart"></canvas>
                </div>
            </div>

            <!-- KD -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h4 class="font-semibold text-gray-800 mb-3">KD éš¨æ©ŸæŒ‡æ¨™</h4>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-sm">Kå€¼</span>
                        <span class="font-semibold">{{technicalAnalysis.kValue}}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">Då€¼</span>
                        <span class="font-semibold">{{technicalAnalysis.dValue}}</span>
                    </div>
                    <div class="text-center mt-3">
                        <span class="px-2 py-1 text-xs rounded-full {{getKDClass technicalAnalysis.kValue technicalAnalysis.dValue}}">
                            {{getKDText technicalAnalysis.kValue technicalAnalysis.dValue}}
                        </span>
                    </div>
                </div>
                <div class="indicator-chart">
                    <canvas id="kdChart"></canvas>
                </div>
            </div>

            <!-- å¸ƒæ—å¸¶ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h4 class="font-semibold text-gray-800 mb-3">å¸ƒæ—å¸¶</h4>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-sm">ä¸Šè»Œ</span>
                        <span class="font-semibold">${{technicalAnalysis.bollingerUpper}}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">ä¸­è»Œ</span>
                        <span class="font-semibold">${{technicalAnalysis.bollingerMiddle}}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">ä¸‹è»Œ</span>
                        <span class="font-semibold">${{technicalAnalysis.bollingerLower}}</span>
                    </div>
                    <div class="text-center mt-3">
                        <span class="px-2 py-1 text-xs rounded-full {{getBollingerClass stockInfo.closePrice technicalAnalysis.bollingerUpper technicalAnalysis.bollingerLower}}">
                            {{getBollingerText stockInfo.closePrice technicalAnalysis.bollingerUpper technicalAnalysis.bollingerLower}}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç§»å‹•å¹³å‡ç·šè¡¨æ ¼ -->
        <div class="mt-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š ç§»å‹•å¹³å‡ç·šåˆ†æ</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å‡ç·š</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ•¸å€¼</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">èˆ‡æ”¶ç›¤åƒ¹æ¯”è¼ƒ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è¶¨å‹¢</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">MA5</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${{technicalAnalysis.ma5}}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm {{getMAComparisonClass stockInfo.closePrice technicalAnalysis.ma5}}">
                                    {{getMAComparisonText stockInfo.closePrice technicalAnalysis.ma5}}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">çŸ­æœŸ</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">MA20</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${{technicalAnalysis.ma20}}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm {{getMAComparisonClass stockInfo.closePrice technicalAnalysis.ma20}}">
                                    {{getMAComparisonText stockInfo.closePrice technicalAnalysis.ma20}}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">ä¸­æœŸ</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">MA60</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${{technicalAnalysis.ma60}}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm {{getMAComparisonClass stockInfo.closePrice technicalAnalysis.ma60}}">
                                    {{getMAComparisonText stockInfo.closePrice technicalAnalysis.ma60}}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">é•·æœŸ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è¼”åŠ©å‡½æ•¸
        function formatVolume(volume) {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(2) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(2) + 'K';
            }
            return volume;
        }

        function getRecommendationClass(recommendation) {
            switch(recommendation) {
                case 'strong_buy': return 'bg-green-100 text-green-800';
                case 'buy': return 'bg-blue-100 text-blue-800';
                case 'hold': return 'bg-yellow-100 text-yellow-800';
                case 'sell': return 'bg-orange-100 text-orange-800';
                case 'strong_sell': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getRecommendationText(recommendation) {
            switch(recommendation) {
                case 'strong_buy': return 'å¼·çƒˆè²·é€²';
                case 'buy': return 'è²·é€²';
                case 'hold': return 'æŒæœ‰';
                case 'sell': return 'è³£å‡º';
                case 'strong_sell': return 'å¼·çƒˆè³£å‡º';
                default: return '-';
            }
        }

        function getTrendClass(trend) {
            switch(trend) {
                case 'upward': return 'text-green-600';
                case 'downward': return 'text-red-600';
                case 'sideways': return 'text-yellow-600';
                default: return 'text-gray-600';
            }
        }

        function getTrendText(trend) {
            switch(trend) {
                case 'upward': return 'ä¸Šå‡';
                case 'downward': return 'ä¸‹é™';
                case 'sideways': return 'ç›¤æ•´';
                default: return '-';
            }
        }

        function getRSIClass(rsi) {
            if (rsi >= 70) return 'text-red-600';
            if (rsi <= 30) return 'text-green-600';
            return 'text-blue-600';
        }

        function getRSIText(rsi) {
            if (rsi >= 70) return 'è¶…è²·';
            if (rsi <= 30) return 'è¶…è³£';
            return 'æ­£å¸¸';
        }

        function refreshData() {
            location.reload();
        }

        // åˆå§‹åŒ–åœ–è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            // é€™è£¡å°‡åˆå§‹åŒ–å„ç¨®åœ–è¡¨
            // Kç·šåœ–ã€æŠ€è¡“æŒ‡æ¨™åœ–ã€RSIåœ–ã€MACDåœ–ã€KDåœ–ç­‰
            initCharts();
        });

        function initCharts() {
            // å¾APIç²å–åœ–è¡¨æ•¸æ“šä¸¦æ¸²æŸ“
            fetch(`/api/chart/candlestick/{{stockInfo.symbol}}`)
                .then(response => response.json())
                .then(data => {
                    renderCandlestickChart(data);
                });

            fetch(`/api/chart/technical/{{stockInfo.symbol}}`)
                .then(response => response.json())
                .then(data => {
                    renderTechnicalChart(data);
                });
        }

        function renderCandlestickChart(data) {
            // æ¸²æŸ“Kç·šåœ–é‚è¼¯
        }

        function renderTechnicalChart(data) {
            // æ¸²æŸ“æŠ€è¡“æŒ‡æ¨™åœ–é‚è¼¯
        }
    </script>
</body>
</html>