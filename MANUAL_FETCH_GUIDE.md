# 📊 台灣股市資料收集系統 - 手動抓取網頁界面

## 🚀 快速開始

### 1. 啟動應用程式
```bash
cd /Users/ming/Desktop/ch026
npm run start
```

### 2. 訪問管理面板
在瀏覽器中打開：
- **主管理面板**: http://localhost:3000/admin/fetch-data
- **重定向首頁**: http://localhost:3000/admin

---

## 🎯 功能介紹

### 📅 單日資料抓取
- **用途**: 抓取指定單一日期的所有股市資料
- **操作**: 選擇日期後點擊「抓取資料」
- **包含**: 大盤資料 + 個股資料
- **自動檢查**: 會自動跳過假日

### 📊 批次日期範圍抓取
- **用途**: 抓取指定日期範圍內所有工作日的資料
- **操作**: 設定開始日期和結束日期，點擊「批次抓取」
- **智能處理**: 自動跳過假日，只抓取工作日資料
- **進度顯示**: 顯示每個日期的處理結果

### ⚡ 快速選擇
預設快速選項：
- **最近1天**: 抓取昨天的資料
- **最近3天**: 抓取最近3個工作日
- **最近7天**: 抓取最近一週的工作日
- **最近30天**: 抓取最近一個月的工作日

### 💡 建議日期
系統會自動顯示最近10個工作日，方便快速選擇常用日期。

---

## 📋 抓取的資料類型

### 🏛️ 大盤籌碼資料 (MarketStats)
- 加權指數 (TAIEX)
- 三大法人買賣超
- 信用交易餘額
- 期貨未平倉
- 選擇權數據
- 匯率資料

### 📈 個股資料 (Tickers)
- **上市股票** (TWSE): 開高低收、成交量等
- **上櫃股票** (TPEx): 完整交易資料
- **指數資料**: 各類股指數
- **基本面**: PE/PB 比值、殖利率等

---

## 🔧 API 端點

### GET /admin/fetch-data
- **功能**: 顯示資料抓取管理界面
- **回應**: HTML 網頁

### POST /admin/fetch-single-day
- **功能**: 抓取單一日期資料
- **參數**: `{ "date": "2024-11-01" }`
- **回應**: JSON 結果

### POST /admin/fetch-date-range
- **功能**: 批次抓取日期範圍資料
- **參數**: `{ "startDate": "2024-11-01", "endDate": "2024-11-03" }`
- **回應**: JSON 批次結果

### GET /admin/status
- **功能**: 獲取系統狀態
- **回應**: 系統運行狀態

---

## 📊 使用範例

### 1. 抓取昨天的資料
1. 打開管理面板
2. 日期欄位會預設為今天
3. 修改為昨天的日期
4. 點擊「抓取資料」

### 2. 批次抓取一週資料
1. 點擊「最近7天」快速選擇
2. 確認日期範圍正確
3. 點擊「批次抓取」
4. 等待處理完成，查看結果

### 3. 抓取特定日期範圍
1. 在「開始日期」選擇起始日
2. 在「結束日期」選擇結束日
3. 點擊「批次抓取」
4. 系統會自動跳過假日

---

## ⚠️ 注意事項

### 🕐 抓取時間
- **建議時間**: 每日 15:30 之後（股市收盤後）
- **避免時間**: 交易時間內（9:00-13:30）

### 📅 假日處理
- 系統會自動檢查台灣的國定假日
- 假日會自動跳過，不會嘗試抓取資料
- 週末也會自動跳過

### 🚦 資料來源狀態
- 資料來源包括：TWSE、TPEx、TAIFEX 等
- 如果某個資料源暫時無法訪問，會跳過該部分
- 可在 API 狀態頁面查看各資料源狀態

### 💾 資料儲存
- 所有資料儲存在 MongoDB 資料庫
- 重複資料會自動跳過，不會重複儲存
- 可透過資料庫查詢確認抓取結果

---

## 🔍 故障排除

### 網頁無法訪問
```bash
# 檢查應用程式是否正在運行
lsof -i :3000

# 重新啟動應用程式
npm run start
```

### 資料抓取失敗
1. 檢查網路連線
2. 確認選擇的是工作日
3. 查看瀏覽器開發者工具的錯誤訊息
4. 檢查應用程式日誌

### MongoDB 連接問題
```bash
# 檢查 MongoDB 狀態
brew services list | grep mongodb

# 啟動 MongoDB
brew services start mongodb-community
```

---

## 📈 監控與驗證

### 檢查抓取結果
```bash
# 連接 MongoDB 檢查資料
mongosh scraper

# 查看最新資料統計
db.marketstats.countDocuments()
db.tickers.countDocuments()

# 查看最新日期的資料
db.marketstats.find().sort({date: -1}).limit(1)
```

### API 狀態監控
訪問：http://localhost:3000/api-status/health

---

## 🎉 完成！

現在你可以透過直觀的網頁界面輕鬆管理台灣股市資料的抓取工作，不需要再手動執行命令行指令！

**管理面板地址**: http://localhost:3000/admin/fetch-data